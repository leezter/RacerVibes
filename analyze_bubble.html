<!DOCTYPE html>
<html>
<head>
    <title>Bubble Sprite Analysis</title>
    <style>
        body { margin: 20px; font-family: monospace; }
        canvas { border: 2px solid #333; margin: 10px 0; }
        .info { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Bubble.png Sprite Analysis</h1>
    <div class="info" id="info">Loading...</div>
    
    <h2>Full Image</h2>
    <canvas id="fullCanvas"></canvas>
    
    <h2>Current Extraction (sx: 522, sy: 122, sw: 460, sh: 460)</h2>
    <canvas id="currentCanvas"></canvas>
    
    <h2>Suggested Extraction</h2>
    <canvas id="suggestedCanvas"></canvas>
    <div class="info" id="suggestion"></div>
    
    <script>
        const img = new Image();
        img.onload = function() {
            const fullCanvas = document.getElementById('fullCanvas');
            const currentCanvas = document.getElementById('currentCanvas');
            const suggestedCanvas = document.getElementById('suggestedCanvas');
            
            // Show full image
            fullCanvas.width = img.width;
            fullCanvas.height = img.height;
            const fullCtx = fullCanvas.getContext('2d');
            fullCtx.drawImage(img, 0, 0);
            
            // Draw rectangle showing current extraction
            fullCtx.strokeStyle = 'red';
            fullCtx.lineWidth = 3;
            fullCtx.strokeRect(522, 122, 460, 460);
            
            // Show current extraction
            currentCanvas.width = 460;
            currentCanvas.height = 460;
            const currentCtx = currentCanvas.getContext('2d');
            currentCtx.drawImage(img, 522, 122, 460, 460, 0, 0, 460, 460);
            
            // Find bounding box of non-transparent pixels
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = img.width;
            tempCanvas.height = img.height;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.drawImage(img, 0, 0);
            const imageData = tempCtx.getImageData(0, 0, img.width, img.height);
            const pixels = imageData.data;
            
            let minX = img.width, minY = img.height, maxX = 0, maxY = 0;
            for (let y = 0; y < img.height; y++) {
                for (let x = 0; x < img.width; x++) {
                    const alpha = pixels[(y * img.width + x) * 4 + 3];
                    if (alpha > 10) { // Consider pixels with alpha > 10 as content
                        if (x < minX) minX = x;
                        if (y < minY) minY = y;
                        if (x > maxX) maxX = x;
                        if (y > maxY) maxY = y;
                    }
                }
            }
            
            const suggestedSx = minX;
            const suggestedSy = minY;
            const suggestedSw = maxX - minX + 1;
            const suggestedSh = maxY - minY + 1;
            
            // Draw rectangle showing suggested extraction on full canvas
            fullCtx.strokeStyle = 'green';
            fullCtx.lineWidth = 3;
            fullCtx.strokeRect(suggestedSx, suggestedSy, suggestedSw, suggestedSh);
            
            // Show suggested extraction
            suggestedCanvas.width = suggestedSw;
            suggestedCanvas.height = suggestedSh;
            const suggestedCtx = suggestedCanvas.getContext('2d');
            suggestedCtx.drawImage(img, suggestedSx, suggestedSy, suggestedSw, suggestedSh, 0, 0, suggestedSw, suggestedSh);
            
            document.getElementById('info').textContent = `Image: ${img.width}x${img.height}`;
            document.getElementById('suggestion').innerHTML = `
                <strong>Current extraction (RED box):</strong> sx: 522, sy: 122, sw: 460, sh: 460<br>
                <strong>Suggested extraction (GREEN box):</strong> sx: ${suggestedSx}, sy: ${suggestedSy}, sw: ${suggestedSw}, sh: ${suggestedSh}<br>
                <strong>Content coverage:</strong> ${((suggestedSw * suggestedSh) / (img.width * img.height) * 100).toFixed(2)}%
            `;
        };
        img.src = 'assets/vehicles/Bubble.png';
    </script>
</body>
</html>
